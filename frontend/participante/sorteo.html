<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="icon" type="image/png" href="../assets/imagenes/mathome-favicon.png">
  <title>Mathome — Elige tus números y participa</title>

  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/participant.css">
  <link rel="stylesheet" href="../assets/js/chat/chat.css">


</head>
<body>
  <div class="main-container sorteo-page">

    <!-- HEADER COMPACTO (sticky) -->
    <header class="sorteo-header">
      <div class="sorteo-header__text">
        <h1 id="tituloSorteo" class="sorteo-title">Cargando ronda...</h1>
        <p id="subtituloSorteo" class="sorteo-subtitle">
          Estás a unos pasos de asegurar tus números 🎟️
        </p>
      </div>

      <div class="sorteo-header__actions">
        <button type="button" class="btn btn-secondary btn-back has-ico" onclick="location.href='dashboard.html'" aria-label="Volver a rondas" title="Volver">
          <span class="btn-ico">←</span>
          <span class="btn-label">Volver</span>
        </button>

        <button id="btnMisNumeros" type="button" class="btn btn-primary has-ico hidden" onclick="location.href='mis-numeros.html'">
          <span class="btn-ico">🎟</span>
          <span class="btn-label">Mis números</span>
        </button>
      </div>
    </header>

    <!-- CARD PRINCIPAL DEL SORTEO -->
    <section class="sorteo-card-premium">
      <p id="tituloPremio" class="sorteo-card__eyebrow">Ronda</p>

      <div class="sorteo-card__list">
        <p class="sorteo-info-line">✅ Incluye producto digital + acceso a la ronda en vivo</p>
        <p class="sorteo-info-line">🎁 Beneficio principal: <span id="textoPremio">—</span></p>
        <p class="sorteo-info-line">💲 Precio por número: <span id="textoPrecio">—</span></p>
        <p class="sorteo-info-line">🔢 Total de números: <span id="textoCantidad">—</span></p>
      </div>

      <div class="progress-wrapper">
        <div class="progress-container">
          <div id="progressFill" class="progress-bar"></div>
        </div>
        <p class="progress-text" id="textoProgreso">Cargando ocupación...</p>
        <p class="progress-tip-text" id="textoCupos">Quedan cupos disponibles</p>
      </div>
    </section>

    <!-- ESTADO DEL USUARIO -->
    <section class="sorteo-status">
      <div id="estadoNoParticipante" class="status-card status-locked">
        <div class="status-title">🔒 Aún no participas</div>
        <div class="status-text">Elige tus números para entrar a la sala.</div>
      </div>

      <div id="misNumerosEnSorteoCard" class="status-card status-ok" style="display:none;">
        <div class="status-title">✅ Ya estás participando en esta ronda</div>
        <div class="status-text" id="misNumerosEnSorteoTexto">Cargando...</div>
        <div id="misNumerosEnSorteoChips" class="numeros-chips-wrap"></div>
      </div>
    </section>

    <!-- FLUJO POR PASOS -->
    <section class="sorteo-flow">

      <!-- PASO 1 -->
      <details class="info-accordion" open>
        <summary>
          <span>🎯 Paso 1 · Elige tus números</span>
          <span class="pago-nequi-badge">1</span>
        </summary>

        <div class="sorteo-numeros-card">
          <div class="sorteo-numeros-header">
            <h3>Elige tus números</h3>
            <p class="text-muted microhint">
              Máx. <strong><span id="maxNumerosTexto">5</span></strong> por compra
            </p>
          </div>

          <div class="numeros-scroll">
            <div id="gridNumeros" class="numeros-grid"></div>
          </div>

          <div class="mini-resumen-compra">
            <div class="mini-resumen-row">
              <span class="mini-label">Selección</span>
              <strong id="resumenNumeros">Ninguno todavía</strong>
            </div>
            <div class="mini-resumen-row">
              <span class="mini-label">Total</span>
              <strong id="resumenTotal">$0</strong>
            </div>
          </div>
        </div>
      </details>

      <!-- PASO 2 -->
      <details class="info-accordion">
        <summary>
          <span>💳 Paso 2 · Paga por Nequi</span>
          <span class="pago-nequi-badge">2</span>
        </summary>

        <div class="pago-nequi-card">
          <div class="pago-nequi-header">
            <div>
              <p class="pago-nequi-title">Paga tus números por Nequi</p>
              <p class="pago-nequi-subtitle">Asegura tu lugar en menos de 1 minuto ⚡</p>
            </div>
          </div>

          <div class="pago-nequi-main">
            <div class="pago-nequi-datos">
              <p class="pago-nequi-label">Número Nequi</p>
              <p class="pago-nequi-value pago-nequi-value--big">3123450890</p>

              <p class="pago-nequi-label">Titular</p>
              <p class="pago-nequi-value">Mar** Gom**</p>

              <button type="button" class="btn btn-primary btn-nequi-copy" onclick="copiarNequi()">
                📋 Copiar número de Nequi
              </button>
            </div>

            <div class="pago-nequi-steps">
              <ol>
                <li>Elige tus números y mira el total.</li>
                <li>Envía el pago con la nota <strong>"Ronda + tu nombre"</strong>.</li>
                <li>Sube el comprobante.</li>
              </ol>
              <p class="pago-nequi-seguro">🛡️ Revisión manual para mantener la dinámica transparente.</p>
            </div>
          </div>

          <div class="pago-nequi-footer">
            💡 Tip: si te gustan ciertos números, págalos apenas los elijas.
          </div>
        </div>
      </details>

      <!-- PASO 3 -->
      <details class="info-accordion">
        <summary>
          <span>🧾 Paso 3 · Subir comprobante</span>
          <span class="pago-nequi-badge">3</span>
        </summary>

        <div class="sorteo-compra-card">
          <div class="comprobante-upload">
            <label for="inputComprobante">Comprobante de pago</label>
            <p class="text-muted microhint">Que se vea <strong>monto</strong> y <strong>referencia</strong>.</p>

            <input type="file" id="inputComprobante" accept="image/*" />

            <div id="previewComprobante" class="comprobante-preview oculto">
              <p class="comprobante-preview-title">Vista previa:</p>
              <img id="imgPreview" alt="Comprobante" />
            </div>
          </div>

          <button id="btnConfirmar" class="btn btn-primary btn-full-width">
            Confirmar participación
          </button>

          <details class="mini-ayuda">
            <summary>¿Qué pasa después?</summary>
            <p class="text-muted">
              Tus números quedan <strong>pendientes</strong> hasta revisión. Al aprobar, quedan <strong>activos</strong>.
            </p>
          </details>
        </div>
      </details>

    </section>

    <!-- CHAT -->
    <section id="chatContainer" class="chat-card chat-sala" style="display: none;">
      <div class="chat-header">
        <div>
          <h3>💬 Sala de la ronda</h3>
          <p class="text-muted microhint">🔒 Solo participantes pueden escribir</p>
        </div>
      </div>
      <div id="chatBody" class="chat-messages"></div>
      <div class="chat-input-wrap">
        <input id="chatInput" type="text" placeholder="Escribe aquí..." maxlength="120">
        <button id="chatSend" class="btn btn-primary has-ico">
          <span class="btn-ico">➤</span>
          <span class="btn-label">Enviar</span>
        </button>
      </div>
      <p id="chatHint" class="text-muted chat-hint"></p>
    </section>

  </div>

  <div id="toast" class="toast hidden">Mensaje</div>

  <script src="../assets/js/app-config.js"></script>
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/auth.js"></script>
  <script src="../assets/js/welcomeModal.js"></script>
  <script type="module" src="../assets/js/participante/sorteo-detalle.js"></script>
</body>
</html>









