<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="../assets/imagenes/logoparaemoji.png">
  <title>Siempre Gana ‚Äî Panel Admin</title>

  <!-- CSS del sistema -->
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
  <link rel="stylesheet" href="../assets/js/chat/chat.css">
  <link rel="stylesheet" href="../assets/js/chat/chat-admin.css"><!-- nuevo -->
</head>
<body class="admin-body">
  <div class="admin-wrapper">

    <!-- HEADER ADMIN -->
    <header class="admin-header">
      <div class="admin-header-left">
        <h1>Panel de Administraci√≥n</h1>
        <span class="admin-subtitle">
          Control total de sorteos, comprobantes y ruletas en un solo lugar.
        </span>

        <!-- Cinta de estado / confianza -->
        <div class="admin-status-pill">
          <span class="dot"></span>
          <span>Sistema en l√≠nea ¬∑ Validaciones manuales para m√°xima transparencia</span>
        </div>
      </div>
      <div class="admin-header-right">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="location.href='crear-sorteo.html'">
          ‚ûï Crear sorteo
        </button>
        <button
          type="button"
          class="btn btn-danger"
          onclick="logout()">
          Salir
        </button>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="admin-main">

      <!-- üìë COMPROBANTES PENDIENTES -->
      <section id="bloqueComprobantes" class="card">
        <div class="card-title-row">
          <div>
            <h2>üìë Comprobantes pendientes</h2>
            <p class="text-muted">
              Cada comprobante aprobado libera n√∫meros reales para los participantes.
              Revisa monto, fecha y referencia antes de aceptar.
            </p>
          </div>
          <div class="card-title-right text-muted mini-hint">
            Tip: una bandeja ‚Äúen cero‚Äù antes de girar ruletas transmite seriedad.
          </div>
        </div>

        <div id="comprobantes" class="table-wrapper">
          <!-- Aqu√≠ se inyectan las tarjetas o filas de comprobantes -->
        </div>
      </section>

      <!-- üéØ SORTEOS ACTIVOS -->
      <section class="card" style="margin-top:18px;">
        <div class="card-title-row">
          <div>
            <h2>üéØ Sorteos activos</h2>
            <p class="text-muted">
              Observa el avance de cada sorteo, llena cupos y pasa a la ruleta cuando
              todo est√© validado.
            </p>
          </div>
          <div class="card-title-right text-muted mini-hint">
            Recomendado: anuncia con tiempo qu√© sorteo ser√° el pr√≥ximo en pasar a ruleta.
          </div>
        </div>

        <div id="sorteosAdmin" class="table-wrapper">
          <!-- Aqu√≠ se listan los sorteos (cards o tabla) -->
        </div>
      </section>

      <!-- üí¨ CHAT ADMIN -->
      <section class="card" style="margin-top:18px;">
        <div class="card-title-row">
          <h2>üí¨ Chat de Administraci√≥n</h2>
          <p class="text-muted">Comunicaci√≥n en tiempo real con los participantes y control de moderaci√≥n.</p>
        </div>

        <div id="adminChatContainer" class="chat-card admin-chat">
          <div id="adminChatBody" class="chat-messages"></div>
          <div class="chat-input-wrap">
            <input id="adminChatInput" placeholder="Mensaje global o moderaci√≥n...">
            <button id="adminChatSend">Enviar</button>
          </div>
          <p id="adminChatHint"></p>
        </div>
      </section>

    </main>
  </div>

  <!-- Toast de feedback -->
  <div id="toast" class="toast hidden">Acci√≥n realizada</div>

  <!-- Scripts existentes -->
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/auth.js"></script>
  <script type="module" src="../assets/js/admin/index.js"></script>

  <!-- Script del chat admin -->
  <script>
    // Define el sorteo actual (puedes obtenerlo din√°micamente)
    window.currentSorteoId = '1'; // ejemplo: ID 1
  </script>

  <script type="module">
    import { initAdminChat } from '../assets/js/chat/adminChat.js';

    const sorteoId = window.currentSorteoId;
    const token = localStorage.getItem('jwt');

    if (token) {
      const payload = JSON.parse(atob(token.split('.')[1]));
      if (payload.rol === 'admin') {
        initAdminChat({ sorteoId, token });
      } else {
        document.getElementById('adminChatHint').textContent = 'Tu rol no es admin, no puedes usar este chat.';
      }
    } else {
      document.getElementById('adminChatHint').textContent = 'Inicia sesi√≥n para usar el chat admin.';
    }
  </script>
</body>
</html>
