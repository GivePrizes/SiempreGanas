<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="icon" type="image/png" href="../assets/imagenes/mathome-favicon.png">
  <title>Mathome — Panel Admin</title>

  <!-- CSS del sistema -->
  <link rel="stylesheet" href="../assets/css/common.css">
  <link rel="stylesheet" href="../assets/css/admin.css">
  <link rel="stylesheet" href="../assets/js/chat/chat.css">
  <link rel="stylesheet" href="../assets/js/chat/chat-admin.css"><!-- nuevo -->
</head>
<body class="admin-body">
  <div class="admin-wrapper">

    <!-- HEADER ADMIN -->
    <header class="admin-header">
      <div class="admin-header-left">
        <h1>Panel de Administración</h1>
        <span class="admin-subtitle">
          Control total de rondas, comprobantes y resultados en un solo lugar.
        </span>

        <!-- Cinta de estado / confianza -->
        <div class="admin-status-pill">
          <span class="dot"></span>
          <span>Sistema en línea · Validaciones manuales para máxima transparencia</span>
        </div>
      </div>
      <div class="admin-header-right">
        <button
          type="button"
          class="btn btn-secondary"
          onclick="location.href='crear-sorteo.html'">
          ➕ Crear ronda
        </button>
        <button
          type="button"
          class="btn btn-danger"
          onclick="logout()">
          Salir
        </button>
      </div>
    </header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="admin-main">

      <!-- 📑 COMPROBANTES PENDIENTES -->
      <section id="bloqueComprobantes" class="card">
        <div class="card-title-row">
          <div>
            <h2>📑 Comprobantes pendientes</h2>
            <p class="text-muted">
              Cada comprobante aprobado libera números reales para los participantes.
              Revisa monto, fecha y referencia antes de aceptar.
            </p>
          </div>
          <div class="card-title-right text-muted mini-hint">
            Tip: una bandeja “en cero” antes de iniciar rondas transmite seriedad.
          </div>
        </div>

        <div id="comprobantes" class="table-wrapper">
          <!-- Aquí se inyectan las tarjetas o filas de comprobantes -->
        </div>
      </section>

      <!-- 🎯 SORTEOS ACTIVOS -->
      <section class="card" style="margin-top:18px;">
        <div class="card-title-row">
          <div>
            <h2>🎯 Rondas activas</h2>
            <p class="text-muted">
              Observa el avance de cada ronda, llena cupos y pasa a la ruleta cuando
              todo esté validado.
            </p>
          </div>
          <div class="card-title-right text-muted mini-hint">
            Recomendado: anuncia con tiempo qué ronda será la próxima en pasar a resultado en vivo.
          </div>
        </div>

        <div id="sorteosAdmin" class="table-wrapper">
          <!-- Aquí se listan los sorteos (cards o tabla) -->
        </div>
      </section>

      <!-- 💬 CHAT ADMIN -->
      <section class="card" style="margin-top:18px;">
        <div class="card-title-row">
          <h2>💬 Chat de Administración</h2>
          <p class="text-muted">Comunicación en tiempo real con los participantes y control de moderación.</p>
        </div>

        <div id="adminChatContainer" class="chat-card admin-chat">
          <div id="adminChatBody" class="chat-messages"></div>
          <div class="chat-input-wrap">
            <input id="adminChatInput" placeholder="Mensaje global o moderación...">
            <button id="adminChatSend">Enviar</button>
          </div>
          <p id="adminChatHint"></p>
        </div>
      </section>

    </main>
  </div>

  <!-- Toast de feedback -->
  <div id="toast" class="toast hidden">Acción realizada</div>

  <!-- Scripts existentes -->
  <script src="../assets/js/app-config.js"></script>
  <script src="../assets/js/config.js"></script>
  <script src="../assets/js/auth.js"></script>
  <script type="module" src="../assets/js/admin/index.js"></script>

  <!-- Script del chat admin -->
  <script>
    // Define el sorteo actual (puedes obtenerlo dinámicamente)
    window.currentSorteoId = '1'; // ejemplo: ID 1
  </script>

  <script type="module">
    import { initAdminChat } from '../assets/js/chat/adminChat.js';

    const sorteoId = window.currentSorteoId;
    const token = localStorage.getItem('token');

    if (token) {
      try {
        const payload = JSON.parse(atob(token.split('.')[1]));
        if (payload.rol === 'admin') {
          initAdminChat({ sorteoId, token });
        } else {
          document.getElementById('adminChatHint').textContent = 'Tu rol no es admin, no puedes usar este chat.';
        }
      } catch {
        document.getElementById('adminChatHint').textContent = 'Token inválido.';
      }
    } else {
      document.getElementById('adminChatHint').textContent = 'Inicia sesión para usar el chat admin.';
    }
  </script>
</body>
</html>








